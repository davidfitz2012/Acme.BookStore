<mat-card>
    <mat-card-header>
        <mat-card-title>
            {{ '::Menu:Books' | abpLocalization }}
        </mat-card-title>
        <div class="flex-spacer"></div>
        <button *abpPermission="'BookStore.Books.Create'" mat-raised-button color="primary" type="button"
            (click)="createBook()">
            <mat-icon>add</mat-icon>
            <span>{{ '::NewBook' | abpLocalization }}</span>
        </button>
    </mat-card-header>
    <mat-card-content>
        <ngx-datatable [rows]="book.items" [count]="book.totalCount" [list]="list" default>
            <ngx-datatable-column [name]="'::Actions' | abpLocalization" [maxWidth]="150" [sortable]="false">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Actions">
                        <mat-icon>more_vert</mat-icon>
                    </button>
                    <mat-menu #menu="matMenu">
                        <button *abpPermission="'BookStore.Books.Edit'" mat-menu-item (click)="editBook(row.id)">
                            <mat-icon>edit</mat-icon>
                            <span>{{ '::Edit' | abpLocalization }}</span>
                        </button>
                        <button *abpPermission="'BookStore.Books.Delete'" mat-menu-item (click)="delete(row.id)">
                            <mat-icon>delete</mat-icon>
                            <span>{{ '::Delete' | abpLocalization }}</span>
                        </button>
                    </mat-menu>
                </ng-template>
            </ngx-datatable-column>

            <ngx-datatable-column [name]="'::Name' | abpLocalization" prop="name"></ngx-datatable-column>
            <ngx-datatable-column [name]="'::Author' | abpLocalization" prop="authorName"
                [sortable]="false"></ngx-datatable-column>

            <ngx-datatable-column [name]="'::Type' | abpLocalization" prop="type">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    {{ '::Enum:BookType.' + row.type | abpLocalization }}1
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::PublishDate' | abpLocalization" prop="publishDate">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    {{ row.publishDate | date }}
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Price' | abpLocalization" prop="price">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    {{ row.price | currency }}
                </ng-template>
            </ngx-datatable-column>
        </ngx-datatable>
    </mat-card-content>
</mat-card>

<abp-modal [(visible)]="isModalOpen">
    <ng-template #abpHeader>
        <h3>{{ (selectedBook.id ? '::Edit' : '::NewBook' ) | abpLocalization }}</h3>
    </ng-template>

    <ng-template #abpBody>
        <form [formGroup]="form" (ngSubmit)="save()" class="material-form">
            <mat-form-field appearance="outline" class="w-100">
                <mat-label>Author</mat-label>
                <mat-select formControlName="authorId" required>
                    <mat-option [value]="null">Select author</mat-option>
                    <mat-option [value]="author.id" *ngFor="let author of authors$ | async">
                        {{ author.name }}
                    </mat-option>
                </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-100">
                <mat-label>Name</mat-label>
                <input matInput formControlName="name" required autofocus>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-100">
                <mat-label>Price</mat-label>
                <input matInput type="number" formControlName="price" required>
                <span matTextPrefix>$&nbsp;</span>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-100">
                <mat-label>Type</mat-label>
                <mat-select formControlName="type" required>
                    <mat-option [value]="null">Select a book type</mat-option>
                    <mat-option [value]="type.value" *ngFor="let type of bookTypes"> 
                        {{ '::Enum:BookType.' + type.value | abpLocalization }}
                    </mat-option>
                </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-100">
                <mat-label>Publish date</mat-label>
                <input matInput [matDatepicker]="picker" formControlName="publishDate" required>
                <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>
        </form>
    </ng-template>

    <ng-template #abpFooter>
        <button mat-button abpClose>
            {{ '::Close' | abpLocalization }}
        </button>

        <button mat-raised-button color="primary" (click)="save()" [disabled]="form.invalid">
            <mat-icon>check</mat-icon>
            {{ '::Save' | abpLocalization }}
        </button>
    </ng-template>

</abp-modal>